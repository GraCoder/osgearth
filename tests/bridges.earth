<Map name="MapZen Elevation">

    <libraries>osgEarthProcedural</libraries>

    <options>
        <cache type="rocksdb" path="cache"/>
    </options>

    <XYZElevation name="MapZen global elevation (S3)" open="true">
        <url>https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png</url>
        <elevation_encoding>terrarium</elevation_encoding>
        <max_level>14</max_level>
        <stitch_edges>true</stitch_edges>
        <vdatum>egm96</vdatum>
    </XYZElevation>
    
    <FlattenedElevation name="Road flattening" min_level="14" max_data_level="14">
        <features>data:osm</features>
        <filters>
            <script><![CDATA[
                'highway' in feature.properties && !('bridge' in feature.properties);
            ]]></script>
        </filters>
        <line_width>12.0</line_width>
        <buffer_width>24.0</buffer_width>
    </FlattenedElevation>

    <XYZImage name="OSM Imagery" caching="false">
        <url>https://[abc].tile.openstreetmap.org/{z}/{x}/{y}.png</url>
        <profile>spherical-mercator</profile>
        <cache_policy usage="none"/>
        <attribution>&#169;OpenStreetMap contributors</attribution>
    </XYZImage>
    
    <gdaldem name="Hill Shade" blend="modulate" opacity="0.25" caching="false">
        <processing>hillshade</processing>
    </gdaldem>
    
    <TiledFeatureModel name="old Bridges" min_level="14" max_level="14" nvgl="true" pickable="true" caching="false" open="false">
        <features>data:osm</features>
        <additive>false</additive>
        <depth_offset>0.75</depth_offset>
        <styles>
            <style type="text/css"><![CDATA[
                roads {
                    select: false; //'highway' in feature.properties && !('bridge' in feature.properties);                   
                    stroke: #2f2f2f;
                    stroke-width: 1px;
                    render-depth-offset: 1m;
                    altitude-clamping: terrain;
                }
                
                bridges {
                    select: feature.properties.bridge === 'yes' && feature.properties.highway !== 'footway';  
                    stroke: #ffffff;
                    stroke-width: 10m;  
                    stroke-tessellation-size: 10m;
                    stroke-linecap: flat;
                    stroke-linejoin: round;
                    stroke-image: "'../data/road.png'";
                    altitude-clamping: terrain;
                    altitude-binding: endpoint;
                    //extrusion-height: 0.0 - 2.0;
                }
              ]]>
            </style>
        </styles>
    </TiledFeatureModel>
    
    <RoadSurface name="Roads" min_level="14" max_data_level="19" tile_size="512" caching="false">
        <features>data:osm</features>
        <styles>
            <style type="text/css"><![CDATA[
                roads {
                    select: 'highway' in feature.properties && !('bridge' in feature.properties);  
                    stroke: #ffffff;
                    stroke-width: 10m;  
                    stroke-tessellation-size: 10m;
                    stroke-linecap: flat;
                    stroke-linejoin: round;
                    stroke-image: "'../data/road.png'";
                    x-altitude-clamping: terrain;
                    
                }
              ]]>
            </style>
        </styles>
    </RoadSurface>
    
    
    
    <Bridges name="new Bridges" open="true">    
        <features>data:osm</features>
        <filters>
            <script><![CDATA[
                feature.properties.bridge === 'yes' && feature.properties.highway !== 'footway';  
            ]]></script>
        </filters>
    
        <styles>
            <library name="assets">
                <skin name="deck-default">
                    <TODO/>
                </skin>
                <skin name="girder-default">
                    <TODO/>
                </skin>
                <skin name="railing-default">
                    <TODO/>
                </skin>                
            </library>
            
            <style type="text/css">
                common {
                    library: assets;
                }
                default : common {
                    bridge-deck-skin: "deck-default";
                    bridge-grider-skin: "girder-default";
                    bridge-railing-skin: "railing-default";
                }
            </style>
            
            <script><![CDATA[
                function getWidth() {
                    return 7.0;
                }
                
                function getGirderHeight() {
                    return 1.5;
                }                
                ]]>
            </script>
        </styles>
    </Bridges>
    
    
    
    <XYZFeatures name="data:osm">
        <url>https://readymap.org/readymap/mbtiles/osm/{z}/{x}/{-y}.pbf</url>
        <min_level>14</min_level>
        <max_level>14</max_level>
        <profile>spherical-mercator</profile>
        <format>pbf</format>
        <fid_attribute>@id</fid_attribute>
    </XYZFeatures>
    
    <Viewpoints home="0" time="0">
        <viewpoint>
            <heading>26.4448</heading>
            <pitch>-12.9265</pitch>
            <range>231.729m</range>
            <long>-77.17893590214751</long>
            <lat>38.97274092974008</lat>
            <height>0.8902343939989805</height>
            <srs>+proj=longlat +datum=WGS84 +no_defs</srs>
        </viewpoint>
    </Viewpoints>
</Map>
